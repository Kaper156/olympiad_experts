{% extends 'base.html' %}
{% set title = title or 'Олимпиады' %}
{% macro editor(form, link='olympiads', args=[]) -%}
    <form action="{{ url_for(link, **args) }}" method="post">
        <table>
{#            <tr>#}
{#                <td>{{ form.name.label }}:</td>#}
{#                <td>{{ form.name() }}</td>#}
{#            </tr>#}
{#            <tr>#}
{#                <td>{{ form.date.label }}:</td>#}
{#                <td>{{ form.date() }}</td>#}
{#            </tr>#}
            {{ form.hidden_tag() }}
            {% for field in form if field.widget.input_type != 'hidden' %}
                <tr>
                    <td>{{ field.label }}:</td>
                    <td>{{ field() }}</td>
                </tr>
            {% endfor %}

            <tr>
                <td></td> {# {{ form.hidden_tag() }} #}
                <td><input type="submit" value="Добавить" class="btn"/></td>
            </tr>
        </table>
    </form>
{%- endmacro %}
{% block content %}
    <div class="olympiads">
        <div class="control-panel">
            <h4 class="text-centered">Управление</h4>
            <a href="#" class="btn right" id="btn-toggle">Добавить</a>
        </div>
        <div class="editor" id="editor">
            <form action="{{ url_for('olympiads') }}" method="post">
                <table>
                    <tr>
                        <td>{{ form.name.label }}:</td>
                        <td>{{ form.name() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.date.label }}:</td>
                        <td>{{ form.date() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.description.label }}:</td>
                        <td>{{ form.description() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.hidden_tag() }}</td>
                        <td><input type="submit" value="Добавить" class="btn"/></td>
                    </tr>
                </table>
            </form>
        </div>
<script>
    function dump(obj) {
        var out = "";
        if(obj && typeof(obj) == "object"){
            for (var i in obj) {
                out += i + ": " + obj[i] + "\n";
            }
        } else {
            out = obj;
        }
        alert(out);
    }
    $(document).ready(function () {
        $('.editor').hide();
        $('#btn-toggle').click(function () {
            $('#editor').toggle();
        });

        $('.btn-toggle').click(function () {
            var object_id = $(this).attr('about');
            var editor = $('div#editor-' + object_id);

{#            if (editor.html() == '') {#}
{#                var query = $.ajax({#}
{#                    url: '/olympiads/edit-' + object_id,#}
{#                    method: "POST",#}
{#                    data: {'id': object_id},#}
{#                    dataType: "json",#}
{#                    success: function (data) {#}
{#                        var html = '';#}
{#                        for (var key in data) {#}
{#                            html += "<tr><td>" + key + "</td><td>" + data[key] + "</td></tr>";#}
{#                        }#}
{#                        editor.html(html);#}
{#                    }#}
{#                });#}
{#            }#}
            editor.toggle();
        });
    });
</script>
        {% for olympiad, form in olympiads %}
            <div class="object-line">
                <div class="info">
                    <p class="field">Название: <span class="value">{{ olympiad.name }}</span></p>

                    <p class="field">Дата: <span class="value">{{ olympiad.date }}</span></p>

                    <p class="field">Описание: <span class="value">{{ olympiad.description }}</span></p>
                </div>
                <div class="buttons">
                    <span class="btn-group">
                        <a id="delete-{{ olympiad.id }}" href="{{ url_for('olympiads') }}" class="btn">
                            <i class="icon_close_alt big"></i>Удалить
                        </a>
                        <a href="#" class="btn-toggle btn" about="{{ olympiad.id }}">
                            <i class="icon_pencil-edit big"></i>Редактировать
                        </a>
                    </span>
                </div>
                <div class="editor" id="editor-{{ olympiad.id }}">
                    {{ editor(form, link='edit_olympiads', args={'id': olympiad.id}) }}
                </div>
            </div>
            <br>
        {% endfor %}
    </div>
{% endblock %}

